> link alla prova : http://www.cs.unibo.it/~renzo/so/pratiche/2023.07.20.pdf

# Esercizio 1

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <dirent.h>

void cprl(const char *src, const char *dst) {
    DIR *dir;
    struct dirent *entry;
    struct stat stat_buf;
    char src_path[PATH_MAX];
    char dst_path[PATH_MAX];

    // Apri la directory sorgente
    if ((dir = opendir(src)) == NULL) {
        perror("opendir");
        return;
    }

    // Crea la directory destinazione se non esiste
    mkdir(dst, 0755);

    // Itera su tutti gli elementi nella directory sorgente
    while ((entry = readdir(dir)) != NULL) {
        if (strcmp(entry->d_name, ".") == 0 || strcmp(entry->d_name, "..") == 0) {
            continue; // Ignora le voci speciali "." e ".."
        }

        snprintf(src_path, sizeof(src_path), "%s/%s", src, entry->d_name);
        snprintf(dst_path, sizeof(dst_path), "%s/%s", dst, entry->d_name);

        // Ottieni le informazioni sul file/directory sorgente
        if (lstat(src_path, &stat_buf) == -1) {
            perror("lstat");
            continue;
        }

        if (S_ISDIR(stat_buf.st_mode)) {
            // Se è una directory, ricorsivamente copia la directory
            cprl(src_path, dst_path);
        } else if (S_ISREG(stat_buf.st_mode)) {
            // Se è un file, crea un link fisico
            if (link(src_path, dst_path) == -1) {
                perror("link");
                continue;
            }
        }
    }

    closedir(dir);
}

int main(int argc, char *argv[]) {
    if (argc != 3) {
        fprintf(stderr, "Usage: %s <source_directory> <destination_directory>\n", argv[0]);
        return 1;
    }

    char *src = argv[1];
    char *dst = argv[2];

    cprl(src, dst);

    return 0;
}

```

# Esercizio 2

```c


#include <time.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <dirent.h>

void copy_file(const char *source_file, const char *target_file) {
    printf("Sto copiando %s in %s\n", source_file, target_file);
    FILE *source, *target;
    char buffer[8192];
    size_t bytes;

    source = fopen(source_file, "rb");
    if (source == NULL) {
        perror("fopen source");
        exit(EXIT_FAILURE);
    }

    target = fopen(target_file, "wb");
    if (target == NULL) {
        fclose(source);
        perror("fopen target");
        exit(EXIT_FAILURE);
    }

    while ((bytes = fread(buffer, 1, sizeof(buffer), source)) > 0) {
        fwrite(buffer, 1, bytes, target);
    }

    fclose(source);
    fclose(target);
}


void cprlt(long int epoch, const char *src, const char *dst) {
    DIR *dir;
    struct dirent *entry;
    struct stat stat_buf;
    char src_path[PATH_MAX];
    char dst_path[PATH_MAX];

    // Apri la directory sorgente
    if ((dir = opendir(src)) == NULL) {
        perror("opendir");
        return;
    }

    // Crea la directory destinazione se non esiste
    mkdir(dst, 0755);

    // Itera su tutti gli elementi nella directory sorgente
    while ((entry = readdir(dir)) != NULL) {
        if (strcmp(entry->d_name, ".") == 0 || strcmp(entry->d_name, "..") == 0) {
            continue; // Ignora le voci speciali "." e ".."
        }

        snprintf(src_path, sizeof(src_path), "%s/%s", src, entry->d_name);
        snprintf(dst_path, sizeof(dst_path), "%s/%s", dst, entry->d_name);

        // Ottieni le informazioni sul file/directory sorgente
        if (lstat(src_path, &stat_buf) == -1) {
            perror("lstat");
            continue;
        }

        long int tempo_di_ultima_modifica;
        tempo_di_ultima_modifica = (long int)difftime(time (NULL),stat_buf.st_mtime ); 

        if (S_ISDIR(stat_buf.st_mode)) {
            // Se è una directory, ricorsivamente copia la directory
            cprlt(epoch, src_path, dst_path);
        } else if (S_ISREG(stat_buf.st_mode)) {
            if(epoch > tempo_di_ultima_modifica){
              printf("creo il lonk");
              if (link(src_path, dst_path) == -1) {
                  perror("link");
                  continue;
              }
            }else{
                  copy_file(src_path, dst_path);
            }

        }
    }

    closedir(dir);
}

long ConvertCharToLong(char *pSrc) {
    int i=1;
    long result = (int)pSrc[0] - '0';
    while(i<strlen(pSrc)){
         result = result * 10 + ((int)pSrc[i] - '0');
         ++i;
    }
    return result;
}

int main(int argc, char *argv[]) {

    long int epoch = ConvertCharToLong(argv[1]);
    char *src = argv[2];
    char *dst = argv[3];

    cprlt(epoch,src, dst);

    return 0;
}

```

# Esercizio 3

```python
import sys
import os

def isascii(s):
    """Check if the characters in string s are in ASCII, U+0-U+7F."""
    return len(s) == len(s.encode())

root_dir = sys.argv[1]

for subdir, dirs, files in os.walk(root_dir):
    for dir in dirs:
        dirpath = os.path.join(subdir, dir)
        if isascii(dirpath):
            print(dirpath)
    for file in files:
        filepath = os.path.join(subdir, file)
        if isascii(filepath):
            print(filepath)

```
